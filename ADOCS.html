<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuestro Mundo de Amor</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            font-family: 'Arial', sans-serif;
        }
        #info {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            color: #ff69b4;
            text-shadow: 0 0 5px white;
            z-index: 100;
            display: block;
            pointer-events: none;
            font-size: 1.2em;
        }
        #message-box {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 80%;
            text-align: center;
            opacity: 0;
            transition: opacity 1s;
            z-index: 100;
            border: 2px solid #ff69b4;
        }
        #controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            color: white;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
            z-index: 100;
        }
        #music-control {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
            color: white;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="info">Nuestro Mundo de Amor ‚ù§Ô∏è</div>
    <div id="message-box"></div>
    <div id="controls">Controles: WASD para moverte, rat√≥n para mirar alrededor</div>
    <div id="music-control">üîä M√∫sica: ON</div>
    
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/GLTFLoader.js"></script>
    
    <script>
        // Variables globales
        let scene, camera, renderer, controls, player;
        let messageBox, currentMessage = null;
        let musicEnabled = true;
        let audioListener, sound;
        let inWeddingArea = false;
        
        // Mensajes rom√°nticos
        const messages = [
            { position: {x: -20, z: 10}, text: "Eres lo mejor que tengo en mi vida, gracias por darme ganas de seguir viviendola üíñ" },
            { position: {x: 15, z: -25}, text: "16 de noviembre de 2023, el d√≠a m√°s feliz de mi vida üíó" },
            { position: {x: 30, z: 5}, text: "Estoy orgulloso de ti cada d√≠a, mi ni√±a hermosa üíï" },
            { position: {x: -10, z: -15}, text: "Tu sonrisa ilumina mis d√≠as m√°s oscuros ‚ú®" },
            { position: {x: 25, z: 20}, text: "Nada me hace m√°s feliz que pasar tiempo contigo üíû" },
            { position: {x: -30, z: -30}, text: "Eres mi raz√≥n para ser mejor persona cada d√≠a üåü" }
        ];
        
        const weddingMessage = "Alg√∫n d√≠a nos casaremos y formaremos una hermosa familia, haremos a Evangeline y G√©nesis reales üíó";
        
        // Inicializar el juego
        function init() {
            // Crear escena
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB); // Cielo azul
            
            // Crear c√°mara
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.y = 5;
            
            // Crear renderizador
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);
            
            // Controles de movimiento
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false;
            controls.minDistance = 1;
            controls.maxDistance = 100;
            controls.maxPolarAngle = Math.PI / 2;
            
            // Configurar elementos de la UI
            messageBox = document.getElementById('message-box');
            
            // Configurar m√∫sica
            setupAudio();
            
            // Configurar iluminaci√≥n
            setupLights();
            
            // Crear terreno y entorno
            createEnvironment();
            
            // Crear pueblo
            createVillage();
            
            // Crear √°rea de boda
            createWeddingArea();
            
            // A√±adir mensajes
            createMessageMarkers();
            
            // Configurar eventos
            window.addEventListener('resize', onWindowResize);
            document.getElementById('music-control').addEventListener('click', toggleMusic);
            
            // Iniciar loop de animaci√≥n
            animate();
        }
        
        function setupAudio() {
            audioListener = new THREE.AudioListener();
            camera.add(audioListener);
            
            sound = new THREE.Audio(audioListener);
            const audioLoader = new THREE.AudioLoader();
            
            audioLoader.load('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3', function(buffer) {
                sound.setBuffer(buffer);
                sound.setLoop(true);
                sound.setVolume(0.5);
                if (musicEnabled) sound.play();
            });
        }
        
        function toggleMusic() {
            musicEnabled = !musicEnabled;
            if (musicEnabled) {
                sound.play();
                document.getElementById('music-control').textContent = 'üîä M√∫sica: ON';
            } else {
                sound.pause();
                document.getElementById('music-control').textContent = 'üîá M√∫sica: OFF';
            }
        }
        
        function setupLights() {
            // Luz ambiental
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            // Luz direccional (sol)
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(100, 100, 50);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 500;
            directionalLight.shadow.camera.left = -100;
            directionalLight.shadow.camera.right = 100;
            directionalLight.shadow.camera.top = 100;
            directionalLight.shadow.camera.bottom = -100;
            scene.add(directionalLight);
            
            // Luz de relleno
            const fillLight = new THREE.DirectionalLight(0xffffff, 0.2);
            fillLight.position.set(-100, 50, 100);
            scene.add(fillLight);
        }
        
        function createEnvironment() {
            // Crear suelo (pradera)
            const groundGeometry = new THREE.PlaneGeometry(200, 200);
            const groundMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x7CFC00,
                roughness: 0.8,
                metalness: 0.2
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Crear √°rboles
            const treeGeometry = new THREE.ConeGeometry(3, 8, 8);
            const trunkGeometry = new THREE.CylinderGeometry(0.5, 0.5, 2);
            const treeMaterial = new THREE.MeshStandardMaterial({ color: 0x228B22 });
            const trunkMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            
            for (let i = 0; i < 30; i++) {
                const treeGroup = new THREE.Group();
                
                const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
                trunk.position.y = 1;
                trunk.castShadow = true;
                treeGroup.add(trunk);
                
                const treeTop = new THREE.Mesh(treeGeometry, treeMaterial);
                treeTop.position.y = 6;
                treeTop.castShadow = true;
                treeGroup.add(treeTop);
                
                // Posicionar √°rboles aleatoriamente en un √°rea de bosque
                const angle = Math.random() * Math.PI * 2;
                const radius = 40 + Math.random() * 20;
                treeGroup.position.x = Math.cos(angle) * radius;
                treeGroup.position.z = Math.sin(angle) * radius;
                
                // Rotaci√≥n aleatoria para variedad
                treeGroup.rotation.y = Math.random() * Math.PI * 2;
                
                // Escala aleatoria
                const scale = 0.8 + Math.random() * 0.4;
                treeGroup.scale.set(scale, scale, scale);
                
                scene.add(treeGroup);
            }
            
            // A√±adir flores
            const flowerGeometry = new THREE.SphereGeometry(0.3, 8, 8);
            const flowerMaterial = new THREE.MeshStandardMaterial({ color: 0xFF69B4 });
            
            for (let i = 0; i < 50; i++) {
                const flower = new THREE.Mesh(flowerGeometry, flowerMaterial);
                flower.position.x = Math.random() * 100 - 50;
                flower.position.z = Math.random() * 100 - 50;
                flower.position.y = 0.3;
                scene.add(flower);
            }
        }
        
        function createVillage() {
            // Crear casas simples para el pueblo
            const houseGeometry = new THREE.BoxGeometry(5, 4, 5);
            const roofGeometry = new THREE.ConeGeometry(3.5, 2, 4);
            roofGeometry.rotateY(Math.PI / 4);
            const houseMaterial = new THREE.MeshStandardMaterial({ color: 0xF5DEB3 });
            const roofMaterial = new THREE.MeshStandardMaterial({ color: 0x8B0000 });
            
            // Crear varias casas en un √°rea
            for (let i = 0; i < 8; i++) {
                const houseGroup = new THREE.Group();
                
                const house = new THREE.Mesh(houseGeometry, houseMaterial);
                house.position.y = 2;
                house.castShadow = true;
                house.receiveShadow = true;
                houseGroup.add(house);
                
                const roof = new THREE.Mesh(roofGeometry, roofMaterial);
                roof.position.y = 5;
                roof.castShadow = true;
                houseGroup.add(roof);
                
                // Posicionar casas en un √°rea semicircular
                const angle = Math.PI * 0.6 * (i / 7) - Math.PI * 0.3;
                const radius = 25;
                houseGroup.position.x = -50 + Math.cos(angle) * radius;
                houseGroup.position.z = -30 + Math.sin(angle) * radius;
                
                // Rotar casas hacia el centro
                houseGroup.rotation.y = -angle + Math.PI;
                
                scene.add(houseGroup);
            }
            
            // Crear un camino
            const pathGeometry = new THREE.PlaneGeometry(10, 60);
            const pathMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const path = new THREE.Mesh(pathGeometry, pathMaterial);
            path.rotation.x = -Math.PI / 2;
            path.position.x = -50;
            path.position.z = -30;
            scene.add(path);
        }
        
        function createWeddingArea() {
            // Crear √°rea de boda (p√©rgola)
            const pergolaMaterial = new THREE.MeshStandardMaterial({ color: 0xFFFFFF });
            
            // Postes
            const postGeometry = new THREE.CylinderGeometry(0.3, 0.3, 4);
            for (let i = 0; i < 4; i++) {
                const post = new THREE.Mesh(postGeometry, pergolaMaterial);
                post.position.x = 40 + (i % 2) * 6;
                post.position.z = -40 + Math.floor(i / 2) * 6;
                post.position.y = 2;
                post.castShadow = true;
                scene.add(post);
            }
            
            // Techo
            const roofGeometry = new THREE.BoxGeometry(8, 0.2, 8);
            const roof = new THREE.Mesh(roofGeometry, pergolaMaterial);
            roof.position.set(43, 4, -37);
            roof.castShadow = true;
            scene.add(roof);
            
            // Flores alrededor
            const flowerGeometry = new THREE.SphereGeometry(0.4, 8, 8);
            const flowerMaterial = new THREE.MeshStandardMaterial({ color: 0xFF69B4 });
            
            for (let i = 0; i < 24; i++) {
                const angle = (i / 24) * Math.PI * 2;
                const radius = 5;
                const flower = new THREE.Mesh(flowerGeometry, flowerMaterial);
                flower.position.x = 43 + Math.cos(angle) * radius;
                flower.position.z = -37 + Math.sin(angle) * radius;
                flower.position.y = 0.4;
                scene.add(flower);
            }
            
            // Alfombra roja
            const carpetGeometry = new THREE.PlaneGeometry(4, 8);
            const carpetMaterial = new THREE.MeshStandardMaterial({ color: 0xFF0000 });
            const carpet = new THREE.Mesh(carpetGeometry, carpetMaterial);
            carpet.rotation.x = -Math.PI / 2;
            carpet.position.set(43, 0.01, -37);
            scene.add(carpet);
        }
        
        function createMessageMarkers() {
            // Crear marcadores para los mensajes (corazones flotantes)
            const heartGeometry = new THREE.SphereGeometry(0.5, 8, 8);
            const heartMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xFF69B4,
                emissive: 0xFF69B4,
                emissiveIntensity: 0.5
            });
            
            messages.forEach((msg, index) => {
                const heart = new THREE.Mesh(heartGeometry, heartMaterial);
                heart.position.set(msg.position.x, 1.5, msg.position.z);
                heart.userData = { message: msg.text };
                scene.add(heart);
                
                // Animaci√≥n de flotaci√≥n
                heart.update = function() {
                    this.position.y = 1.5 + Math.sin(Date.now() * 0.002 + index) * 0.3;
                    this.rotation.y += 0.01;
                };
                
                // Guardar referencia para la animaci√≥n
                heart.userData.update = heart.update;
            });
        }
        
        function showMessage(text) {
            messageBox.textContent = text;
            messageBox.style.opacity = 1;
            
            // Ocultar mensaje despu√©s de 5 segundos
            if (currentMessage) clearTimeout(currentMessage);
            currentMessage = setTimeout(() => {
                messageBox.style.opacity = 0;
                currentMessage = null;
            }, 5000);
        }
        
        function checkPlayerPosition() {
            // Verificar si el jugador est√° cerca de alg√∫n mensaje
            messages.forEach(msg => {
                const distance = Math.sqrt(
                    Math.pow(camera.position.x - msg.position.x, 2) +
                    Math.pow(camera.position.z - msg.position.z, 2)
                );
                
                if (distance < 3 && (!currentMessage || messageBox.textContent !== msg.text)) {
                    showMessage(msg.text);
                }
            });
            
            // Verificar si el jugador est√° en el √°rea de boda
            const weddingDistance = Math.sqrt(
                Math.pow(camera.position.x - 43, 2) +
                Math.pow(camera.position.z - (-37), 2)
            );
            
            if (weddingDistance < 8) {
                if (!inWeddingArea) {
                    showMessage(weddingMessage);
                    inWeddingArea = true;
                }
            } else {
                inWeddingArea = false;
            }
        }
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            // Actualizar controles
            controls.update();
            
            // Actualizar animaciones de corazones
            scene.children.forEach(child => {
                if (child.userData && child.userData.update) {
                    child.userData.update();
                }
            });
            
            // Verificar posici√≥n del jugador
            checkPlayerPosition();
            
            // Renderizar escena
            renderer.render(scene, camera);
        }
        
        // Iniciar el juego
        init();
    </script>
</body>
</html>
